<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="KBfEthUSZQCRbWviYR5cAUjNkvYqSP7RTLNR02OK">
    <meta name="base_url" content="public">

    <style>
        :root {
            --primary_color: #502f8f;
            --primary_color_hover: #502f8fcc;
        }
        .invoice-calculations, .tax-summary {
            display: flex;
            flex-direction: column;
            padding-left: 20px;
            }
            
            .hr {
                margin-top: 0rem;
                margin-bottom: 0rem;

                border: 0;
                border-top: 1px solid rgba(0, 0, 0, .1);
            }

            .circle-icon {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background-color: #e77878;
                color: white;
                cursor: pointer;
            }

            .circle-icon i {
                font-size: 12px;
            }

    </style>

    <!-- Title -->
    <title>HiFi Salon</title>

    <!-- Favicon -->
    <link href="public/storage/images/app/favicon.png" rel="icon" type="image/png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>

    <!-- Icons -->
    <link rel="stylesheet" href="assets/vendor/fonts/materialdesignicons.css"/>
    <!-- CSS -->
    <link href="public/includes/css/nucleo.css" rel="stylesheet">
    <link rel="stylesheet" href="public/includes/css/core.css" class="template-customizer-core-css"/>
    <!-- <link rel="stylesheet" href="assets/vendor/css/rtl/core.css" class="template-customizer-core-css"/> -->
    <link rel="stylesheet" href="assets/vendor/css/rtl/theme-default.css" class="template-customizer-theme-css"/>
    <link href="public/includes/css/all.min.css" rel="stylesheet">
    <link href="public/includes/css/sweetalert2.scss">
    <link href="public/includes/css/jquery.timepicker.css" rel="stylesheet">

    <link rel="stylesheet" href="assets/vendor/css/pages/app-invoice.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@5.9.55/css/materialdesignicons.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.21/b-1.6.2/b-flash-1.6.2/b-html5-1.6.2/b-print-1.6.2/datatables.min.css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <script src="public/includes/js/jquery-3.5.1.js"></script>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.css' rel='stylesheet'/>
    <!-- Argon CSS -->
    <link href="public/includes/css/argon.css" rel="stylesheet">
    <link href="public/includes/css/invoice/invoice-create.css" rel="stylesheet">
    <link href="public/includes/css/invoice/invoice-preview.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <script>

    </script>
</head>

<body class="">
<div class="preload">
    <img src="public/storage/images/app/loader.gif" class="loader" alt="">
</div>
<div class="for-loader">
    <form id="logout-form" action="public/logout" method="POST" style="display: none;">
        <input type="hidden" name="_token" value="5O57DdIfZRvjAFgpQy1mzNGXw26aW2G9AGIdnel7">
    </form>
    <nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main">
        <div id="navbar-left"></div>
    </nav>

    <div class="main-content">
        <div id="navbar-top"></div>

        <div class="header pt-7"
             style="background-image: url(public/storage/images/app/bg_img.jpg); background-size: cover; background-position: center center;">
            <span class="mask bg-gradient-dark opacity-7"></span>
            <div class="container-fluid">
                <div class="header-body">
                    <div class="row align-items-center py-4 pb-7">
                        <div class="col-lg-6 col-7">
                            <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Content wrapper -->
        <div class="content-wrapper">
            <!-- Content -->
            <div class="container-xxl flex-grow-1 container-p-y">
                <div class="row invoice-add">
                    <!-- Invoice Add-->
                    <div class="col-lg-9 col-12 mb-lg-0 mb-4">
                        <div class="card invoice-preview-card">
                            <div class="card-body">
                                <form class="source-item pt-1">
                                    <div class="mb-3" data-repeater-list="group-a">
                                        <div class="invoice-box">
                                            <table class="main" cellpadding="0" cellspacing="0">
                                                <tr class="top">
                                                    <td colspan="4" class="header">
                                                        <table style="width: 100%;">
                                                            <tr>
                                                                <td class="title">
                                                                    <img id="customLogo" src="https://i.ibb.co/YRXpXDR/Whats-App-Image-2023-07-28-at-9-30-21-PM.jpg" style="width: 125px; height: auto;">
                                                                </td>
                                                                <td>
                                                                    <b><span class="invoice-date"><b>Date: January 1, 2015</span></b>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <dl class="row mb-2 g-2">
                                                                    <dt class="col-sm-4 mb-2 d-md-flex align-items-center justify-content-end">
                                                                        <span class="fw-normal">Cust Name:</span>
                                                                    </dt>
                                                                    <dd class="col-sm-8">
                                                                        <div class="input-group input-group-merge">
                                                                            <input type="text" class="form-control" placeholder="Name" id="custName"/>
                                                                        </div>
                                                                    </dd>
                                                                </dl>
                                                                <dl class="row mb-2 g-2">
                                                                    <dt class="required col-sm-4 mb-2 d-md-flex align-items-center justify-content-end">
                                                                        <span class="fw-normal">Contact:</span>
                                                                    </dt>
                                                                    <dd class="col-sm-8">
                                                                        <div class="input-group input-group-merge">
                                                                            <input type="text" class="form-control" placeholder="Contact" id="contact"/>
                                                                        </div>
                                                                    </dd>
                                                                </dl>
                                                                <dl class="row mb-2 g-2">
                                                                    <dt class="col-sm-4 mb-2 d-md-flex align-items-center justify-content-end">
                                                                        <span class="fw-normal">Membership:</span>
                                                                    </dt>
                                                                    <dd class="col-sm-8" style="text-align: left;">
                                                                        <div class="input-group input-group-merge">
                                                                            <input type="text" class="form-control membershipId" readonly placeholder="MembershipId" id="membershipId"/>
                                                                        </div>
                                                                        <!-- <label class="switch switch-primary me-0">
                                                                            <input type="checkbox" class="switch-input" id="membership"/>
                                                                            <span class="switch-toggle-slider">
                                                                                <span class="switch-on"></span>
                                                                                <span class="switch-off"></span>
                                                                            </span>
                                                                            <span class="switch-label membershipId"></span>
                                                                        </label> -->
                                                                    </dd>
                                                                </dl>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <dl class="row mb-2 g-2">
                                                                    <dt class="col-sm-4 mb-2 d-md-flex align-items-center justify-content-end">
                                                                        <span class="fw-normal">Email Id:</span>
                                                                    </dt>
                                                                    <dd class="col-sm-8">
                                                                        <input type="text" class="form-control" placeholder="Email" id="custEmailId"/>
                                                                    </dd>
                                                                </dl>
                                                                <dl class="row mb-2 g-2">
                                                                    <dt class="col-sm-4 mb-2 d-md-flex align-items-center justify-content-end">
                                                                        <span class="fw-normal">Address:</span>
                                                                    </dt>
                                                                    <dd class="col-sm-8">
                                                                        <textarea class="form-control" rows="4" placeholder="Address" id="custAddress"></textarea>
                                                                    </dd>
                                                                </dl>
                                                                <!-- <dl class="row mb-2 g-2">
                                                                    <dt class="col-sm-4 mb-2 d-md-flex align-items-center justify-content-end">
                                                                        <span class="fw-normal">Biller</span>
                                                                    </dt>
                                                                    <dd class="col-sm-8">
                                                                        <input type="text" class="form-control" placeholder="Biller" id="biller"/>
                                                                    </dd>
                                                                </dl> -->
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="heading">
                                                    <td width="30%">Services</td>
                                                    <td width="20%">Qty</td>
                                                    <td width="30%">Rate</td>
                                                    <td width="20%">Price</td>
                                                </tr>
                                            
                                                <tr class="item">
                                                    <td colspan="4">
                                                        <table style="width: 100%;">
                                                            <tr>
                                                                <td width="30%">
                                                                    <select class="form-select item-details">
                                                                        <option selected disabled>Select Service</option>
                                                                    </select>
                                                                </td>
                                                                <td width="20%">
                                                                    <input
                                                                        type="number"
                                                                        class="form-control invoice-item-qty"
                                                                        value="1"
                                                                        min="1"
                                                                        max="50"
                                                                    />
                                                                </td>
                                                                <td width="30%">
                                                                    <input
                                                                        type="number"
                                                                        class="form-control invoice-item-rate"
                                                                        min="1" max="1000000"
                                                                        placeholder="00"
                                                                        readonly
                                                                    />
                                                                </td>
                                                                <td class="subtotal1" width="20%">
                                                                    0.00
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="30%">
                                                                    <select class="form-select item-stylist mt-2">
                                                                        <option selected disabled>Select Stylist</option>
                                                                    </select>
                                                                </td>
                                                                <td colspan="2" width="50%"></td>
                                                                <!-- <td width="30%">
                                                                    <input
                                                                        type="number"
                                                                        class="form-control stylist-service-charge mt-2"
                                                                        min="1" max="1000000"
                                                                        placeholder="00"
                                                                        readonly
                                                                    />
                                                                </td> -->
                                                                <td class="subtotal2">
                                                                    <a class="btn-delete-row">
                                                                        <div class="circle-icon">
                                                                            <i class="fas fa-times"></i>
                                                                        </div>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                </tr>
                                                
                                                <tr>
                                                    <td colspan="4" class="add-button">
                                                        <button type="button" class="btn btn-primary btn-add-row">
                                                            <i class="mdi mdi-plus me-1"></i> Add Item
                                                        </button>
                                                    </td>
                                                </tr>
                                                <tr class="subTotal">
                                                    <td colspan="3" style="text-align: right"><b>Sub Total:</b></td>
                                                    <td>
                                                        0.00
                                                    </td>
                                                </tr>
                                                <tr class="discount">
                                                    <td colspan="3" style="text-align: right"><b>Discount(%)</b></td>
                                                    <td>
                                                        <select
                                                            style="width:120px; float: right;text-align: center;"
                                                            class="form-select item-discount"
                                                            id="discount">
                                                            <option selected value="STORE0" disabled>Discount</option>
                                                            <option value="STORE50">5%</option>
                                                            <option value="STORE75">7.5%</option>
                                                            <option value="STORE100">10%</option>
                                                            <option value="STORE125">12.5%</option>
                                                            <option value="STORE150">15%</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                <tr class="gst">
                                                    <td>
                                                        <button type="button" class="btn btn-primary btn-calculate-total">
                                                            Calculate Total
                                                        </button>
                                                    </td>
                                                    <td colspan="2" style="text-align: right"><b>GST(%)</b></td>
                                                    <td>
                                                        <input
                                                            style="width:120px; float: right; text-align: right;"
                                                            type="text" 
                                                            class="form-control" 
                                                            placeholder="0%" 
                                                            id="gst"
                                                            readonly
                                                        />
                                                    </td>
                                                </tr>
                                                <tr class="total">
                                                    <td colspan="3" style="text-align: right"><b>Total:</b></td>
                                                    <td>
                                                        0.00
                                                    </td>
                                                </tr>
                                                <tr class="roundOff">
                                                    <td colspan="3" style="text-align: right">(roundOff)</td>
                                                    <td>
                                                        0.00
                                                    </td>
                                                </tr>
                                                
                                                <!-- <tr class="heading">
                                                    <td colspan="3">
                                                        Payment Method
                                                    </td>
                                                    <td>
                                                        Check #
                                                    </td>
                                                </tr>
                                            
                                                <tr class="details">
                                                    <td colspan="3">
                                                        Check
                                                    </td>
                                                    <td>
                                                        1000
                                                    </td>
                                                </tr> -->
                                            </table>
                                            <table width="80%">
                                                <tr>
                                                    <td>
                                                        <dl class="row mb-2 mt-2 g-2">
                                                            <dt class="col-sm-4 mb-2 d-md-flex align-items-center justify-content-end">
                                                                <span class="fw-normal">Notes:</span>
                                                            </dt>
                                                            <dd class="col-sm-8">
                                                                <textarea class="form-control" rows="2" placeholder="Notes" id="invoiceNote"></textarea>
                                                            </dd>
                                                        </dl>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div> 
                    <!-- /Invoice Add-->
                    <!-- Invoice Actions -->
                    <div class="col-lg-3 col-12 invoice-actions">
                        <div style="position: sticky; top: 20px; z-index: 1000;">
                            <div class="form-floating form-floating-outline mb-4">
                                <h3 class="offcanvas-title mb-2">Payment Method</h5>
                                <div style="margin-left: 2rem;">
                                    <div>
                                        <input type="checkbox" class="dt-checkboxes form-check-input cash" id="cash">
                                        <label class="ml-2" style="margin-top: 2px;" for="cash">Cash</label>
                                    </div>
                                    <div>
                                        <input type="checkbox" class="dt-checkboxes form-check-input upi" id="upi">
                                        <label class="ml-2" style="margin-top: 2px;" for="upi">UPI Transfer</label>
                                    </div>
                                    <div>
                                        <input type="checkbox" class="dt-checkboxes form-check-input cardPay" id="cardPay">
                                        <label class="ml-2" style="margin-top: 2px;" for="cardPay">Debit/Credit Card</label>
                                    </div>
                                </div>
                                <!-- <select class="form-select bg-body mb-4" id="select-payment-add">
                                    <option value="Cash">Cash</option>
                                    <option value="Card">Credit/Debit Card</option>
                                    <option value="UPI Transfer">UPI Transfer</option>
                                </select> -->
                                <!-- <label for="select-payment-add" class="bg-body">Accept payments via</label> -->
                            </div>
                            <div class="form-floating form-floating-outline mb-4 paymentDetails">
                                <h3 class="offcanvas-title mb-2">Payment Details</h5>
                                <div class="border rounded position-relative cashDetails p-2 mb-1">
                                    <div class="form-floating form-floating-outline">
                                        <input type="text" class="form-control" id="cashAmount" placeholder="Cash Amount">
                                        <label for="cashAmount">Amount</label>
                                    </div>
                                </div>
                                <div class="border rounded position-relative UPIDetails p-2 mb-1">
                                    <div class="form-floating form-floating-outline mb-4">
                                        <input type="text" class="form-control" id="upiTxnID" placeholder="UPI Txn ID">
                                        <label for="upiTxnID">UPI Txn ID</label>
                                    </div>
                                    <div class="form-floating form-floating-outline">
                                        <input type="text" class="form-control" id="upiAmount" placeholder="UPI Amount">
                                        <label for="upiAmount">UPI Amount</label>
                                    </div>
                                </div>
                                <div class="border rounded position-relative cardDetails p-2 mb-1">
                                    <div class="form-floating form-floating-outline mb-4">
                                        <input type="text" class="form-control" id="cardTxnID" placeholder="Card Txn ID">
                                        <label for="cardTxnID">Card Txn ID</label>
                                    </div>
                                    <div class="form-floating form-floating-outline">
                                        <input type="text" class="form-control" id="cardAmount" placeholder="Card Amount">
                                        <label for="cardAmount">Card Amount</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-4">
                                <div class="card-body">
                                    <button
                                        class="btn btn-primary d-grid w-100 mb-3"
                                        data-bs-toggle="offcanvas"
                                        data-bs-target="#sendInvoiceOffcanvas"
                                    >
                                        <span class="d-flex align-items-center justify-content-center text-nowrap">
                                            <i class="mdi mdi-send-outline scaleX-n1-rtl me-2"></i>Send Invoice</span>
                                    </button>
                                    <button type="button" id="previewInvoice" disabled
                                    class="btn btn-outline-secondary d-grid w-100">Save & Preview</button>
                                    <!-- <button type="button" class="btn btn-outline-secondary d-grid w-100">Save</button> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /Invoice Actions -->
                </div>
                <!-- Offcanvas -->
                <!-- Send Invoice Sidebar -->
                <div class="offcanvas offcanvas-end" id="sendInvoiceOffcanvas" aria-hidden="true">
                    <div class="offcanvas-header mb-3">
                        <h5 class="offcanvas-title">Send Invoice</h5>
                        <button
                            type="button"
                            class="btn-close text-reset"
                            data-bs-dismiss="offcanvas"
                            aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body flex-grow-1">
                        <form>
                            <div class="form-floating form-floating-outline mb-4">
                                <input
                                        type="text"
                                        class="form-control"
                                        id="invoice-from"
                                        value="shelbyComapny@email.com"
                                        placeholder="company@email.com"/>
                                <label for="invoice-from">From</label>
                            </div>
                            <div class="form-floating form-floating-outline mb-4">
                                <input
                                        type="text"
                                        class="form-control"
                                        id="invoice-to"
                                        value="qConsolidated@email.com"
                                        placeholder="company@email.com"/>
                                <label for="invoice-to">To</label>
                            </div>
                            <div class="form-floating form-floating-outline mb-4">
                                <input
                                        type="text"
                                        class="form-control"
                                        id="invoice-subject"
                                        value="Invoice of purchased Admin Templates"
                                        placeholder="Invoice regarding goods"/>
                                <label for="invoice-subject">Subject</label>
                            </div>
                            <div class="form-floating form-floating-outline mb-4">
                    <textarea class="form-control" name="invoice-message" id="invoice-message" style="height: 190px">
                        Dear Queen Consolidated,
                                Thank you for your business, always a pleasure to work with you!
                                We have generated a new invoice in the amount of $95.59
                                We would appreciate payment of this invoice by 05/11/2021</textarea>
                                <label for="invoice-message">Message</label>
                            </div>
                            <div class="mb-4">
                    <span class="badge bg-label-primary">
                    <i class="mdi mdi-link-variant mdi-14px me-1"></i>
                    <span class="align-middle">Invoice Attached</span>
                    </span>
                            </div>
                            <div class="mb-3 d-flex flex-wrap">
                                <button type="button" class="btn btn-primary me-3" data-bs-dismiss="offcanvas">
                                    Send
                                </button>
                                <button type="button" class="btn btn-label-secondary" data-bs-dismiss="offcanvas">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- /Send Invoice Sidebar -->

                <!-- /Offcanvas -->
            </div>
            <!-- / Content -->

            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
                <div class="container-xxl">
                    <div
                            class="footer-container d-flex align-items-center justify-content-between py-3 flex-md-row flex-column">
                        <div class="mb-2 mb-md-0">
                            ©
                            <script>
                                document.write(new Date().getFullYear());
                            </script>
                            <a href="https://asvignesh.in" target="_blank"
                                class="footer-link fw-medium">laserpoint</a>
                        </div>
                    </div>
                </div>
            </footer>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->

    <script src="public/includes/js/popper.min.js"></script>
    <script src="public/includes/js/Chart.min.js"></script>
    <script src="public/includes/js/Chart.extension.js"></script>
    <script src="public/includes/js/jquery.min.js"></script>
    <script src="public/includes/js/bootstrap.bundle.min.js"></script>
    <script src="public/includes/js/argon.js"></script>
    <script src="public/includes/js/jquery.scrollbar.min.js"></script>
    <script src="public/includes/js/jquery-scrollLock.min.js"></script>
    <script src="public/includes/js/sweetalert.all.js"></script>
    <script src="public/includes/js/jquery.timepicker.js"></script>
    <!-- <script src="public/includes/js/common.js"></script> -->
    <script src="public/includes/js/jquery-repeater.js"></script>

    <!-- <script src="public/includes/js/invoice/invoice-add.js"></script> -->

    <script src="public/includes/js/map.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=" async defer></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>

    <script type="text/javascript"
            src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.21/b-1.6.2/b-flash-1.6.2/b-html5-1.6.2/b-print-1.6.2/datatables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script src="public/includes/js/myjavascript.js"></script>

    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="assets/vendor/libs/jquery/jquery.js"></script>
    <script src="assets/vendor/libs/popper/popper.js"></script>
    <script src="assets/vendor/js/bootstrap.js"></script>
    <script src="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="assets/vendor/libs/node-waves/node-waves.js"></script>

    <script src="assets/vendor/libs/hammer/hammer.js"></script>
    <script src="assets/vendor/libs/i18n/i18n.js"></script>
    <script src="assets/vendor/libs/typeahead-js/typeahead.js"></script>

    <script src="assets/vendor/js/menu.js"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="assets/vendor/libs/flatpickr/flatpickr.js"></script>
    <script src="assets/vendor/libs/cleavejs/cleave.js"></script>
    <script src="assets/vendor/libs/cleavejs/cleave-phone.js"></script>
    <script src="assets/vendor/libs/jquery-repeater/jquery-repeater.js"></script>

    <!-- Page JS -->
    <!-- <script src="assets/js/offcanvas-send-invoice.js"></script> -->
    <script src="assets/js/app-invoice-add.js"></script>
    <script src="assets/js/app-invoice-add-total.js"></script>
    
    <script type="module">
        $(document).ready(function () {
            var services = [] 
            var employees = [] 
            var membership = false
            var storeName; 
            var existingClient = false

            showPaymentDetails();

            $("#body-content").load("dashboard.html");
            $("#navbar-left").load("inc/navbar.inc-admin.html");
            $("#navbar-top").load("inc/navbar-top-inc-admin.html", function () {
                // Set the initial content
                storeName = $(this).find(':selected').val();
                console.log('selectedOption', storeName)
                getServices(storeName);
                getEmployees(storeName);
                $('#store').on('change', function () {
                    storeName = $(this).find(':selected').val();
                    getServices(storeName);
                    getEmployees(storeName);
                });

                function getServices(storeName) {
                    $.ajax({
                        url: baseUrl + 'stores/' + storeName + '/services',
                        method: 'GET',
                        headers: {
                        "Authorization": "Bearer " + bearerToken
                        },
                        success: function(data) { 
                            services = data
                            $('.item-details').empty();
                            $('.item-details').append("<option selected disabled>Select Service</option>");
                            $.each(data, function(i,item){
                                $('.item-details').append('<option value="'+data[i].name+'">'+data[i].displayName+'</optoin>');
                            });  
                        },
                        error: function() {
                            console.log('Failed to fetch services');
                        }
                    });
                }

                function getEmployees(storeName) {
                    $.ajax({
                        url: baseUrl + 'stores/' + storeName + '/employee',
                        method: 'GET',
                        headers: {
                        "Authorization": "Bearer " + bearerToken
                        },
                        success: function(data) { 
                            employees = data
                            $('.item-stylist').empty();
                            $('.item-stylist').append("<option selected disabled>Select Stylist</option>");
                            $.each(data, function(i,item){
                                $('.item-stylist').append('<option value="'+data[i]._id+'">'+data[i].fullName+'</optoin>');
                            });  
                        },
                        error: function() {
                            console.log('Failed to fetch employees');
                        }
                    });
                }

                // if($('.item').length <= 1) {
                //     $($('.item')[0]).find(".btn-delete-row").remove();
                // }

            });

            $("#cash").on('change', showPaymentDetails)
            $("#upi").on('change', showPaymentDetails)
            $("#cardPay").on('change',showPaymentDetails)

            function showPaymentDetails() {
                if($("#cash").is(":checked")) {
                    $(".cashDetails").show();
                } else {
                    $(".cashDetails").hide();
                }

                if($("#upi").is(":checked")) {
                    $(".UPIDetails").show();
                } else {
                    $(".UPIDetails").hide();
                }

                if($("#cardPay").is(":checked")) {
                    $(".cardDetails").show();
                } else {
                    $(".cardDetails").hide();
                }
            }

            $('table.main').on('change', 'select.item-details', function () {
                var $row = $(this).closest("tr.item");
                const parent = $("select.item-details").parent("tr.item");
                const selectedService = $row.find('.item-details').val()
                const membershipIdValue = $('#membershipId').val();
                services.forEach((service, i) => {
                    if(service.name === selectedService) {
                        $row.find('input.invoice-item-rate').val(
                            membershipIdValue ? service.membershipPrice : service.regularPrice
                        ).change();
                    }
                })
            });

            $('table.main').on('change', 'select.item-stylist', function () {
                var $row = $(this).closest("tr.item");
                const parent = $("select.item-stylist").parent("tr.item");
                const selectedEmployee = $row.find('.item-stylist').val()
                employees.forEach((employee, i) => {
                    if(employee._id === selectedEmployee) {
                        $row.find('input.stylist-service-charge').val(employee.rate).change();
                    }
                })
            });

            $("#contact").keyup(function() {
                var contactValue = $(this).val();
                if (contactValue.length === 10) {
                    getClientDetails(contactValue);
                    getMembershipDetails(contactValue);
                }
            });

            function getClientDetails(contact) {
                $.ajax({
                    url: baseUrl + 'client/' + contact,
                    method: 'GET',
                    headers: {
                    "Authorization": "Bearer " + bearerToken
                    },
                    success: function(response) {
                        existingClient = true
                        $('#custName').val(response.name);
                        $('#custAddress').val(response.address);
                        $('#custEmailId').val(response.email);
                    },
                    error: function() {
                        existingClient = false
                        console.log('Failed to fetch client details');
                    }
                });
            }

            function getMembershipDetails(contact) {
                $.ajax({
                    url: baseUrl + 'client/' + contact + '/membership/',
                    method: 'GET',
                    headers: {
                    "Authorization": "Bearer " + bearerToken
                    },
                    success: function(response) {
                        if(response.membershipId) {
                            // $('#membership').prop('checked', 'checked');
                            $('.membershipId').val(response.membershipId);
                        } else {
                            $('.membershipId').val('');
                        }
                    },
                    error: function() {
                        // $('#membership').prop('checked', '');
                        $('.membershipId').val('');
                        console.log('Failed to fetch membership details');
                    }
                });
            }

            $(".btn-calculate-total ").on('click', function() {
                calculateInvoiceTotal();
                $("#previewInvoice").prop("disabled", false);
            });

            function calculateInvoiceTotal() {
                console.log("Invoice preview");
                localStorage.removeItem("invoiceData");

                const discount = $('select.item-discount').val()
                var items = $('.item').map((idx, val) => {
                    const $row = $(val)
                    const service = $row.find('.item-details').val()
                    const stylist = $row.find('.item-stylist').val()
                    const itemQty = $row.find('input.invoice-item-qty').val();
                    const itemRate = $row.find('input.invoice-item-rate').val();
                    // const stylistCharge = $row.find('input.stylist-service-charge').val();
                    
                    return {
                        itemType: "service",
                        itemName: service,
                        itemQty: itemQty,
                        itemPrice: itemRate,
                        serviceProviderId: stylist,
                        serviceCharge: 0
                    }
                }).toArray()

                const invoiceDataForTotal = {
                    coupons: [
                        discount
                    ],
                    items: items
                };
                var totalTax = 0;
                $.ajax({
                    url: baseUrl + 'stores/' + storeName + '/invoice/calculateOrderTotal',
                    method: 'post',
                    headers: {
                    "Authorization": "Bearer " + bearerToken
                    },
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(invoiceDataForTotal),
                    success: function (res) {
                        const billAmount = res.billAmount
                        billAmount.taxSummary.forEach(function(tax) {
                            totalTax += tax.percentage;
                        });                       
                        $('#gst').val(totalTax + "%")
                        $('.total td:eq(1)').text(Number(billAmount.total).toFixed(2));
                        $('.roundOff td:eq(1)').text(Number(billAmount.roundOff).toFixed(2));
                    },
                    error: function (error) { }
                });
            }

            $("#previewInvoice").on('click', function() {
                previewInvoice();
            });
            
            function previewInvoice() {
                console.log("Invoice save & preview");
                localStorage.removeItem("invoiceData");
                localStorage.removeItem("tenderedAmount");

                const paymentMethod = []
                const cashCollected = +parseFloat(Number($('#cashAmount').val())).toFixed(2);
                const cashChecked = $("#cash").is(":checked");
                const invoiceTotal = +parseFloat(Number($('.total td:eq(1)').text())).toFixed(2);

                var cashPay = $("#cash").is(":checked") ? paymentMethod.push({
                    paymentMode: 'CASH',
                    paymentTransactionId: 'NA',
                    amount: (cashCollected > invoiceTotal) ? invoiceTotal : cashCollected
                }) : '';
                var upiPay = $("#upi").is(":checked") ? paymentMethod.push({
                    paymentMode: 'UPI',
                    paymentTransactionId: $('#upiTxnID').val(),
                    amount: $('#upiAmount').val()
                }) : '';
                var cardPay = $('#cardPay').is(":checked") ? paymentMethod.push({
                    paymentMode: 'CARD',
                    paymentTransactionId: $('#cardTxnID').val(),
                    amount: $('#cardAmount').val()
                }) : '';

                var custName = $('#custName').val();
                var custAddress = $('#custAddress').val();
                var custEmailId = $('#custEmailId').val();
                const invoiceNote = $('textarea#invoiceNote').val();
                const discount = $('select.item-discount').val()
                var contact = $('#contact').val();
                var items = $('.item').map((idx, val) => {
                    const $row = $(val)
                    const service = $row.find('.item-details').val()
                    const stylist = $row.find('.item-stylist').val()
                    const itemQty = $row.find('input.invoice-item-qty').val();
                    const itemRate = $row.find('input.invoice-item-rate').val();
                    // const stylistCharge = $row.find('input.stylist-service-charge').val();
                    
                    return {
                        itemType: "service",
                        itemName: service,
                        itemQty: itemQty,
                        itemPrice: itemRate,
                        serviceProviderId: stylist,
                        serviceCharge: 0
                    }
                }).toArray()

                const invoiceData = {
                    // custName: custName,
                    // custAddress: custAddress,
                    // custEmailId: custEmailId,
                    clientMobile: contact,
                    coupons: [
                        discount
                    ],
                    paymentDetails: paymentMethod,
                    items: items,
                    notes: invoiceNote
                };
                console.log('invoiceData', invoiceData)
                
                if(!existingClient) {
                    const clientData = {
                        mobile: contact,
                        name: custName,
                        dob: "01-01-1997",
                        address: custAddress,
                        email: custEmailId
                    }

                    $.ajax({
                        url: baseUrl + 'client/',
                        method: 'post',
                        headers: {
                        "Authorization": "Bearer " + bearerToken
                        },
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(clientData),
                        success: function (res) { 
                            
                        },
                        error: function (error) { }
                    });
                }

                $.ajax({
                    url: baseUrl + 'stores/' + storeName + '/invoice/',
                    method: 'post',
                    headers: {
                        "Authorization": "Bearer " + bearerToken
                    },
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(invoiceData),
                    success: function (res) {
                        localStorage.setItem("invoiceData", JSON.stringify(res));
                        if(cashChecked && (cashCollected > invoiceTotal)){
                            localStorage.setItem("tenderedAmount", cashCollected);
                        }
                        window.location.href = "./invoice-preview.html";
                    },
                    error: function (error) { }
                });
            }
        });    
    </script>

    <!-- Argon JS -->
</div>
</body>

</html>